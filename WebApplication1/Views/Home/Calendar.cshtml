@{
    ViewData["Title"] = "Home";
}

<!-- Add FullCalendar CSS -->
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.css' rel='stylesheet' />

<!-- Container for the calendar -->
<div class="container mt-4">
    <div class="row">
        <div class="col-md-12">
            <div id="calendar"></div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- Add FullCalendar JS -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.js'></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');
            
            // Get current date
            var today = new Date();
            var currentMonth = today.getMonth();
            var currentYear = today.getFullYear();

            // Calculate valid date range (1 month before and after current month)
            var validRange = {
                start: new Date(currentYear, currentMonth - 1, 1), // Previous month
                end: new Date(currentYear, currentMonth + 2, 0)    // End of next month
            };

            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev',  // Remove navigation buttons
                    center: 'title',
                    right: 'next'  // Remove navigation buttons
                },
                validRange: validRange,
                navLinks: false,
                dayMaxEvents: 2,
                eventContent: function(arg) {
                    return {
                        html: `
                            <div class="custom-event">
                                <i class="fas ${arg.event.backgroundColor === '#FF0000' ? 'fa-times-circle' : 'fa-check-circle'}"></i>
                                <span>${arg.event.title}</span>
                            </div>
                        `
                    };
                },
                events: [
                    {
                        title: 'Complete Task 1',
                        start: '2024-12-10',
                        backgroundColor: '#00FF00',
                        borderColor: '#00FF00',
                        taskId: 1
                    },
                    {
                        title: 'Incomplete Task 1',
                        start: '2024-12-10',
                        backgroundColor: '#FF0000',
                        borderColor: '#FF0000',
                        taskId: 2
                    },
                    {
                        title: 'Incomplete Task 2',
                        start: '2024-12-10',
                        backgroundColor: '#FF0000',
                        borderColor: '#FF0000',
                        taskId: 3
                    }
                ],
                eventClick: function(info) {
                    window.location.href = '/Task/Details/' + info.event.extendedProps.taskId;
                },
                eventDidMount: function(info) {
                    info.el.style.cursor = 'pointer';
                },
                // Disable navigation beyond valid range
                datesSet: function(info) {
                    var currentView = info.view;
                    var viewStart = currentView.currentStart;
                    
                    // Disable prev button if we're at the earliest allowed month
                    if (viewStart <= validRange.start) {
                        document.querySelector('.fc-prev-button').disabled = true;
                    } else {
                        document.querySelector('.fc-prev-button').disabled = false;
                    }
                    
                    // Disable next button if we're at the latest allowed month
                    if (viewStart >= new Date(validRange.end.getFullYear(), validRange.end.getMonth(), 1)) {
                        document.querySelector('.fc-next-button').disabled = true;
                    } else {
                        document.querySelector('.fc-next-button').disabled = false;
                    }
                },
                dayCellDidMount: function(arg) {
                    // Get all events for this day
                    var dayEvents = calendar.getEvents().filter(function(event) {
                        return event.start.toDateString() === arg.date.toDateString();
                    });

                    // Check if any events exist for this day
                    if (dayEvents.length > 0) {
                        var today = new Date();
                        var cellDate = arg.date;
                        
                        // Check if this date is in the past
                        if (cellDate < today) {
                            // Check if any tasks are incomplete (red background)
                            var hasIncomplete = dayEvents.some(function(event) {
                                return event.backgroundColor === '#FF0000';
                            });

                            if (hasIncomplete) {
                                // More solid light red background
                                arg.el.style.backgroundColor = '#ffebeb';
                            } else {
                                // More solid light green background
                                arg.el.style.backgroundColor = '#ebffeb';
                            }
                        }
                    }
                }
            });
            calendar.render();
        });
    </script>

    <style>
        /* Calendar container styles */
        .fc {
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            padding: 15px;
        }

        /* Header styles */
        .fc-header-toolbar {
            margin-bottom: 1.5em !important;
        }

        .fc-toolbar-title {
            font-size: 1.5em !important;
            font-weight: 600 !important;
            color: #2c3e50;
        }

        /* Remove blue color and underline, make text bold for days and dates */
        .fc-col-header-cell a,
        .fc-daygrid-day-number,
        .fc a {
            color: #333333 !important;
            text-decoration: none !important;
            font-weight: bold !important;
        }

        /* Event styles */
        .fc-event {
            border: none !important;
            border-radius: 6px !important;
            padding: 3px 5px !important;
            margin: 2px 0 !important;
            transition: all 0.3s ease;
        }

        .custom-event {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 2px;
        }

        /* Popover styles */
        .fc-popover {
            border: none !important;
            border-radius: 12px !important;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15) !important;
            overflow: hidden;
        }

        .fc-popover-header {
            background: #f8f9fa !important;
            padding: 12px !important;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 1px solid #eee;
        }

        .fc-popover-body {
            padding: 12px !important;
        }

        .fc-popover .fc-event {
            margin: 5px 0 !important;
            padding: 8px 12px !important;
        }

        /* More link styles */
        .fc-more-link {
            background: #f8f9fa;
            padding: 2px 8px;
            border-radius: 15px;
            color: #666;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .fc-more-link:hover {
            background: #e9ecef;
            color: #333;
        }

        /* Day grid styles */
        .fc-daygrid-day {
            transition: background-color 0.2s;
        }

        .fc-daygrid-day:hover {
            background-color: #f8f9fa;
        }

        .fc-day-today {
            background-color: #e8f4ff !important;
        }

        /* Event hover effects */
        .fc-event:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        /* Complete/Incomplete task styles */
        .fc-event[style*="background-color: rgb(255, 0, 0)"] {
            background: linear-gradient(45deg, #ff4d4d, #ff6666) !important;
            color: white !important;
        }

        .fc-event[style*="background-color: rgb(0, 255, 0)"] {
            background: linear-gradient(45deg, #2ecc71, #27ae60) !important;
            color: white !important;
        }

        /* Other month days */
        .fc .fc-day-other {
            background-color: #f8f9fa;
        }

        .fc .fc-day-other .fc-daygrid-day-number {
            color: #adb5bd !important;
            font-weight: bold !important;
        }

        /* Remove hover color changes */
        .fc-col-header-cell a:hover,
        .fc-daygrid-day-number:hover {
            color: #333333 !important;
        }

        /* Disabled button styles */
        .fc-button:disabled {
            opacity: 0.4;
            cursor: not-allowed !important;
        }

        /* Set fixed height for calendar cells */
        .fc .fc-daygrid-day {
            height: 120px !important; /* Adjust this value as needed */
        }

        /* Ensure content fits within the fixed height */
        .fc .fc-daygrid-day-frame {
            height: 100%;
            min-height: 100%;
        }

        /* Adjust event container height */
        .fc .fc-daygrid-day-events {
            min-height: 0;
            margin-bottom: 0;
        }

        /* Ensure day number positioning */
        .fc .fc-daygrid-day-top {
            flex-direction: row;
            padding: 4px 8px;
        }

        /* Adjust event spacing */
        .fc-daygrid-event-harness {
            margin-top: 2px !important;
            margin-bottom: 2px !important;
        }

        /* Ensure consistent spacing for more link */
        .fc-daygrid-more-link {
            margin: 2px 0;
            padding: 2px 8px;
        }
    </style>
}
